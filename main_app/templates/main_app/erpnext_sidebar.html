{% load static %}

<!-- Sidebar Header -->
<div class="sidebar-header">
    <div class="sidebar-user">
        <img src="{{ request.user.profile_pic}}" alt="User Avatar" class="sidebar-user-avatar" id="sidebar-avatar" onerror="showDefaultAvatar()">
        <i class="fas fa-user-circle sidebar-default-avatar" id="default-avatar" style="display: none;"></i>
        <div class="sidebar-user-info">
            <h6>{{ user.get_full_name|default:user.username }}</h6>
            <small>
                {% if user.user_type == '1' %}
                    Administrator
                {% elif user.user_type == '2' %}
                    Staff Member
                {% else %}
                    Student
                {% endif %}
            </small>
        </div>
    </div>
</div>

<!-- Navigation Menu -->
<div class="nav-section">
    {% if user.user_type == '1' %}
        <!-- Admin Navigation -->
        <h6 class="nav-section-title">Main</h6>
        
        <div class="nav-item">
            {% url 'admin_home' as admin_home %}
            <a href="{{ admin_home }}" class="nav-link {% if admin_home == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-tachometer-alt"></i>
                <span class="nav-text">Dashboard</span>
            </a>
        </div>
        
        <div class="nav-item">
            {% url 'admin_view_profile' as admin_view_profile %}
            <a href="{{ admin_view_profile }}" class="nav-link {% if admin_view_profile == request.path %}active{% endif %}">
                <i class="fas fa-user-circle"></i>
                <span class="nav-text">Profile</span>
            </a>
        </div>

        <h6 class="nav-section-title">Academic Management</h6>
        
        <div class="nav-item has-submenu {% if 'course' in request.path %}open{% endif %}">
            <a href="#" class="nav-link">
                <i class="nav-icon fas fa-graduation-cap"></i>
                <span class="nav-text">Courses</span>
                <i class="nav-arrow fas fa-chevron-right"></i>
            </a>
            <div class="nav-submenu">
                <div class="nav-item">
                    {% url 'add_course' as add_course %}
                    <a href="{{ add_course }}" class="nav-link {% if add_course == request.path %}active{% endif %}">
                        <span class="nav-text">Add Course</span>
                    </a>
                </div>
                <div class="nav-item">
                    {% url 'manage_course' as manage_course %}
                    <a href="{{ manage_course }}" class="nav-link {% if manage_course == request.path or 'edit_course' in request.path %}active{% endif %}">
                        <span class="nav-text">Manage Courses</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="nav-item has-submenu {% if 'subject' in request.path %}open{% endif %}">
            <a href="#" class="nav-link">
                <i class="nav-icon fas fa-book"></i>
                <span class="nav-text">Subjects</span>
                <i class="nav-arrow fas fa-chevron-right"></i>
            </a>
            <div class="nav-submenu">
                <div class="nav-item">
                    {% url 'add_subject' as add_subject %}
                    <a href="{{ add_subject }}" class="nav-link {% if add_subject == request.path %}active{% endif %}">
                        <span class="nav-text">Add Subject</span>
                    </a>
                </div>
                <div class="nav-item">
                    {% url 'manage_subject' as manage_subject %}
                    <a href="{{ manage_subject }}" class="nav-link {% if manage_subject == request.path or 'edit_subject' in request.path %}active{% endif %}">
                        <span class="nav-text">Manage Subjects</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="nav-item has-submenu {% if 'session' in request.path %}open{% endif %}">
            <a href="#" class="nav-link">
                <i class="nav-icon fas fa-calendar-alt"></i>
                <span class="nav-text">Sessions</span>
                <i class="nav-arrow fas fa-chevron-right"></i>
            </a>
            <div class="nav-submenu">
                <div class="nav-item">
                    {% url 'add_session' as add_session %}
                    <a href="{{ add_session }}" class="nav-link {% if add_session == request.path %}active{% endif %}">
                        <span class="nav-text">Add Session</span>
                    </a>
                </div>
                <div class="nav-item">
                    {% url 'manage_session' as manage_session %}
                    <a href="{{ manage_session }}" class="nav-link {% if manage_session == request.path or 'edit_session' in request.path %}active{% endif %}">
                        <span class="nav-text">Manage Sessions</span>
                    </a>
                </div>
            </div>
        </div>

        <h6 class="nav-section-title">User Management</h6>
        
        <div class="nav-item">
            {% url 'add_staff' as add_staff %}
            <a href="{{ add_staff }}" class="nav-link {% if add_staff == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-user-plus"></i>
                <span class="nav-text">Add Staff</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'manage_staff' as manage_staff %}
            <a href="{{ manage_staff }}" class="nav-link {% if manage_staff == request.path or 'edit_staff' in request.path %}active{% endif %}">
                <i class="nav-icon fas fa-users-cog"></i>
                <span class="nav-text">Manage Staff</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'add_student' as add_student %}
            <a href="{{ add_student }}" class="nav-link {% if add_student == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-user-graduate"></i>
                <span class="nav-text">Add Student</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'manage_student' as manage_student %}
            <a href="{{ manage_student }}" class="nav-link {% if manage_student == request.path or 'edit_student' in request.path %}active{% endif %}">
                <i class="nav-icon fas fa-users"></i>
                <span class="nav-text">Manage Students</span>
            </a>
        </div>

        <h6 class="nav-section-title">Communication</h6>
        
        <div class="nav-item">
            {% url 'admin_notify_staff' as admin_notify_staff %}
            <a href="{{ admin_notify_staff }}" class="nav-link {% if admin_notify_staff == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-bell"></i>
                <span class="nav-text">Notify Staff</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'admin_notify_student' as admin_notify_student %}
            <a href="{{ admin_notify_student }}" class="nav-link {% if admin_notify_student == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-bullhorn"></i>
                <span class="nav-text">Notify Students</span>
            </a>
        </div>

        <h6 class="nav-section-title">Reports & Analytics</h6>
        
        <div class="nav-item">
            {% url 'admin_view_attendance' as admin_view_attendance %}
            <a href="{{ admin_view_attendance }}" class="nav-link {% if admin_view_attendance == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-chart-line"></i>
                <span class="nav-text">View Attendance</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'student_feedback_message' as student_feedback_message %}
            <a href="{{ student_feedback_message }}" class="nav-link {% if student_feedback_message == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-comments"></i>
                <span class="nav-text">Student Feedback</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'staff_feedback_message' as staff_feedback_message %}
            <a href="{{ staff_feedback_message }}" class="nav-link {% if staff_feedback_message == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-comment-dots"></i>
                <span class="nav-text">Staff Feedback</span>
            </a>
        </div>

        <h6 class="nav-section-title">Leave Management</h6>
        
        <div class="nav-item">
            {% url 'view_staff_leave' as view_staff_leave %}
            <a href="{{ view_staff_leave }}" class="nav-link {% if view_staff_leave == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-calendar-check"></i>
                <span class="nav-text">Staff Leave</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'view_student_leave' as view_student_leave %}
            <a href="{{ view_student_leave }}" class="nav-link {% if view_student_leave == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-calendar-times"></i>
                <span class="nav-text">Student Leave</span>
            </a>
        </div>

    {% elif user.user_type == '2' %}
        <!-- Staff Navigation -->
        <h6 class="nav-section-title">Main</h6>
        
        <div class="nav-item">
            {% url 'staff_home' as staff_home %}
            <a href="{{ staff_home }}" class="nav-link {% if staff_home == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-tachometer-alt"></i>
                <span class="nav-text">Dashboard</span>
            </a>
        </div>
        
        <div class="nav-item">
            {% url 'staff_view_profile' as staff_view_profile %}
            <a href="{{ staff_view_profile }}" class="nav-link {% if staff_view_profile == request.path %}active{% endif %}">
                <i class="fas fa-user-circle"></i>
                <span class="nav-text">Profile</span>
            </a>
        </div>

        <h6 class="nav-section-title">Academic Management</h6>
        
        <div class="nav-item">
            {% url 'staff_add_result' as staff_add_result %}
            <a href="{{ staff_add_result }}" class="nav-link {% if staff_add_result == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-plus-circle"></i>
                <span class="nav-text">Add Result</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'edit_student_result' as edit_student_result %}
            <a href="{{ edit_student_result }}" class="nav-link {% if edit_student_result == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-edit"></i>
                <span class="nav-text">Edit Results</span>
            </a>
        </div>

        <h6 class="nav-section-title">Attendance</h6>
        
        <div class="nav-item">
            {% url 'staff_take_attendance' as staff_take_attendance %}
            <a href="{{ staff_take_attendance }}" class="nav-link {% if staff_take_attendance == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-check-circle"></i>
                <span class="nav-text">Take Attendance</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'staff_update_attendance' as staff_update_attendance %}
            <a href="{{ staff_update_attendance }}" class="nav-link {% if staff_update_attendance == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-calendar-edit"></i>
                <span class="nav-text">Update Attendance</span>
            </a>
        </div>

        <h6 class="nav-section-title">Library & Resources</h6>
        
        <div class="nav-item">
            {% url 'add_book' as add_book %}
            <a href="{{ add_book }}" class="nav-link {% if add_book == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-book-open"></i>
                <span class="nav-text">Add Books</span>
            </a>
        </div>

        <h6 class="nav-section-title">Communication</h6>
        
        <div class="nav-item">
            {% url 'staff_view_notification' as staff_view_notification %}
            <a href="{{ staff_view_notification }}" class="nav-link {% if staff_view_notification == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-bell"></i>
                <span class="nav-text">Notifications</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'staff_apply_leave' as staff_apply_leave %}
            <a href="{{ staff_apply_leave }}" class="nav-link {% if staff_apply_leave == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-calendar-plus"></i>
                <span class="nav-text">Apply for Leave</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'staff_feedback' as staff_feedback %}
            <a href="{{ staff_feedback }}" class="nav-link {% if staff_feedback == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-comment-alt"></i>
                <span class="nav-text">Feedback</span>
            </a>
        </div>

    {% else %}
        <!-- Student Navigation -->
        <h6 class="nav-section-title">Main</h6>
        
        <div class="nav-item">
            {% url 'student_home' as student_home %}
            <a href="{{ student_home }}" class="nav-link {% if student_home == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-tachometer-alt"></i>
                <span class="nav-text">Dashboard</span>
            </a>
        </div>
        
        <div class="nav-item">
            {% url 'student_view_profile' as student_view_profile %}
            <a href="{{ student_view_profile }}" class="nav-link {% if student_view_profile == request.path %}active{% endif %}">
                <i class="fas fa-user-circle"></i>
                <span class="nav-text">Profile</span>
            </a>
        </div>

        <h6 class="nav-section-title">Academic</h6>
        
        <div class="nav-item">
            {% url 'student_view_attendance' as student_view_attendance %}
            <a href="{{ student_view_attendance }}" class="nav-link {% if student_view_attendance == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-calendar-check"></i>
                <span class="nav-text">View Attendance</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'student_view_result' as student_view_result %}
            <a href="{{ student_view_result }}" class="nav-link {% if student_view_result == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-chart-bar"></i>
                <span class="nav-text">View Results</span>
            </a>
        </div>

        <h6 class="nav-section-title">Library & Resources</h6>
        
        <div class="nav-item">
            {% url 'view_books' as view_books %}
            <a href="{{ view_books }}" class="nav-link {% if view_books == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-book"></i>
                <span class="nav-text">Library Books</span>
            </a>
        </div>

        <h6 class="nav-section-title">Communication</h6>
        
        <div class="nav-item">
            {% url 'student_view_notification' as student_view_notification %}
            <a href="{{ student_view_notification }}" class="nav-link {% if student_view_notification == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-bell"></i>
                <span class="nav-text">Notifications</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'student_apply_leave' as student_apply_leave %}
            <a href="{{ student_apply_leave }}" class="nav-link {% if student_apply_leave == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-calendar-plus"></i>
                <span class="nav-text">Apply for Leave</span>
            </a>
        </div>

        <div class="nav-item">
            {% url 'student_feedback' as student_feedback %}
            <a href="{{ student_feedback }}" class="nav-link {% if student_feedback == request.path %}active{% endif %}">
                <i class="nav-icon fas fa-comment-alt"></i>
                <span class="nav-text">Feedback</span>
            </a>
        </div>
    {% endif %}
</div>

<script>
function showDefaultAvatar() {
    // Hide the broken image
    document.getElementById('sidebar-avatar').style.display = 'none';
    // Show the default FontAwesome icon
    document.getElementById('default-avatar').style.display = 'inline-block';
}

// Also check if profile_pic is empty or null and show default avatar
document.addEventListener('DOMContentLoaded', function() {
    const avatar = document.getElementById('sidebar-avatar');
    const defaultAvatar = document.getElementById('default-avatar');
    
    // Check if src is empty, null, or just whitespace
    if (!avatar.src || avatar.src.trim() === '' || avatar.src === window.location.href) {
        avatar.style.display = 'none';
        defaultAvatar.style.display = 'inline-block';
    }
});
</script>
